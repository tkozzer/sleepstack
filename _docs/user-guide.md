# USER GUIDE — Binaural + Ambience Pipeline (with narration tips)

**Quick start:** `uv run sleepstack --vibe calm -a campfire -m 5` (headphones required).

**Verify output:** Open the mixed file and confirm it's stereo and audible under headphones.

## Installation Options

### Option 1: Run directly with uv (recommended for development)
```bash
uv run sleepstack --help
uv run sleepstack --list-vibes
```

### Option 2: Install globally
```bash
uv tool install .
sleepstack --help
```

### Option 3: Install in a virtual environment
```bash
uv sync
uv run sleepstack --help
```

1. What this setup does
      - Generates a binaural beat track from plain-English "vibes" (calm, deep, etc.).
      - Auto-mixes it with ambience (e.g., campfire) to the exact length you ask for.
      - Saves finished files into your `build/` directory so you can drop them under narration in GarageBand (or your DAW).

2. Prerequisites
   - Python 3.11+ with `uv` package manager
   - Install dependencies:

```bash
uv sync
```

   - The package is structured as `src/sleepstack/` with CLI entry point.
   - Ambience clips are at: `assets/ambience/campfire/{campfire_1m.wav, campfire_5m.wav, campfire_10m.wav}`.
   - Keep sample rate consistent (**48 kHz** for everything). **Stereo headphones required** (don't downmix).
   - All example commands assume your files are in the shown folders; if not, use `--out` / `--binaural-out` to set paths.

3. Directory expectations (already matching your repo)
   - Binaural outputs land in: `build/binaural/`
   - Mixed outputs (binaural + ambience) land in: `build/mix/`
   - You can override output locations with the `--out` flag when needed.

4. The one-command workflow (recommended)
   - Run one command to generate and mix.

Examples

```bash
uv run sleepstack --vibe calm -a campfire -m 5
```

Or with custom output:
```bash
uv run sleepstack --vibe calm -a campfire -m 5 --out build/mix/calm_5m__campfire.wav
```

This will:
   - Create a 5-minute calm binaural bed (6 Hz at 200 Hz).
   - Auto-pick the right campfire clip (1m/5m/10m) and tile/trim it to match 5 minutes.
   - Mix them at comfortable defaults (binaural -15 dB, ambience -21 dB, ambience has 2s fades).
   - Save to `build/mix/` with a sensible filename.

5. Required arguments for `sleepstack`
   - You must include **--vibe + one duration + one ambience source**.
   - `--vibe <name>`  (e.g., calm, deep, soothe, meditate, airy, warm, focus, flow, alert)
   - One duration: `--minutes N` (or `-m`) OR `--seconds N` (or `-s`)
   - One ambience source:
     - `--ambient campfire` (auto-pick from your campfire clips)
     - OR `--ambience-file path/to/ambient.wav` (explicit file; mono is okay; it will be duplicated to L/R)

### New CLI Features
- `--version`: Show package version
- `--list-vibes`: Display all available vibe presets and aliases
- `--verbose` / `-v`: Enable detailed output
- `--quiet` / `-q`: Suppress non-error output

Example with explicit ambience file:
```bash
uv run sleepstack --vibe calm --ambience-file assets/ambience/campfire/campfire_5m.wav -m 5
```

6. Useful optional arguments (`sleepstack`)
   - Binaural generation (overrides preset): `--beat`, `--carrier`, `--samplerate`, `--volume`, `--fade`, `--loop`
   - Paths: `--binaural-out` (raw binaural location), `--out` (final mixed location)
   - Mix levels: `--binaural-db` (default -15), `--ambience-db` (default -21), **`--ambience-fade`** (default 2.0)

Example with custom paths:
```bash
uv run sleepstack --vibe calm -a campfire -m 5 --binaural-out build/binaural/calm_5m_raw.wav
uv run sleepstack --vibe calm -a campfire -m 5 --out build/mix/my_custom_name.wav
```

Tip: If you want a seamless loop bed, add `--loop` (sets binaural fade to 0). For single-play, leave fade at 2s.

7. Typical recipes
   - Sleep-ready meta-core install (deeper settle):

```bash
uv run sleepstack --vibe deep -a campfire -m 5
```

   - Balanced under-narration default (most common):

```bash
uv run sleepstack --vibe calm -a campfire -m 5
```

   - Awake practice (not for sleep):

```bash
uv run sleepstack --vibe focus -a campfire -m 5
```

8. Where the files end up
   - Raw binaural: `build/binaural/<auto-generated name>.wav` (unless you set `--binaural-out`)
   - Final mixed: `build/mix/<binaural_basename>__<ambience_name>.wav` (unless you set `--out`)
   - **File naming pattern:** `binaural__ambience.wav` (e.g., `meta_core_theta6_5min__campfire.wav`) so you can easily identify what's what in Finder.

9. How to place under narration (GarageBand/DAW)
   - Import your mixed bed (binaural + ambience) as one stereo track.
   - Narration: import your voice as a separate mono track.
   - Keep the bed low: binaural around -15 dB; ambience 3–6 dB below the binaural if you tweak manually.
   - Gentle processing on narration only: high-pass ~80 Hz, light compression (2:1), peak normalize to around -1 dBFS on export.
   - If your DAW exports quietly, turn off any 'loudness normalization' and set export to 48 kHz, 24-bit or 16-bit PCM.
   - Don't downmix the bed to mono — binaural needs stereo headphones.

10. Best-fit vibe recommendations for narration (bedtime scripts)
   - Top defaults (under spoken word):
     - `calm` (6.0 Hz @ 200 Hz): balanced, steady theta; the safest first pick.
     - `soothe` (5.0 Hz @ 190 Hz): slightly sleepier than calm; very soft under slow narration.
     - `meditate` (5.5 Hz @ 200 Hz): mild alertness while staying gentle and steady.
   - If your voice is deep/baritone:
     - `airy` (6.0 Hz @ 260 Hz) so the carrier sits above vocal fundamentals; reduces masking.
   - If you want heavier drift toward sleep:
     - `deep` (4.5 Hz @ 180 Hz) but front-load your key lines; you may get drowsy before you finish.
   - Avoid for bedtime narration:
     - `alert`/`flow`/`focus` (≥ 6.5–8 Hz): better for daytime pep or editing sessions; a bit perky for falling asleep mid-script.

11. Level & balance cheat-sheet
   - Bed vs. voice: if you can whisper over the bed comfortably, you're in the right zone.
   - Voice should **peak -1 dBFS** on export; bed should never clip.
   - Binaural: target about -15 dB relative to full scale; ambience ~3–6 dB lower than the binaural.
   - If the bed fights your voice:
     - For deep voices, move to `airy` (carrier 260 Hz) or raise carrier to 220–260 Hz.
     - For higher voices, `calm`/`soothe`/`meditate` at 180–200 Hz carriers sit well.

12. Troubleshooting
   - **Headphones only**: binaural beats don't work on laptop speakers; you need stereo headphones.
   - If ambience is mono, the mixer duplicates it to L/R—this is expected.
   - If you get 'file not found' for campfire clips, confirm they exist at `assets/ambience/campfire/` and are 48 kHz WAVs.
   - "Sample rate mismatch" error: regenerate or resample so both files match (recommend 48000 Hz).
   - "Binaural must be stereo": ensure you generated the bed with `sleepstack` and haven't converted it to mono.
   - The mix feels boomy: reduce ambience level by 2–4 dB or use a gentle low-shelf/HPF on ambience in your DAW.
   - If the bed fights your voice, try **airy** first or raise **carrier** 20–40 Hz.
   - If the mix is silent, check your output levels: try `--binaural-db -12 --ambience-db -18`.
   - Too sleepy too soon: bump vibe from deep → soothe or calm, or shorten your script to get essentials in the first 90 seconds.
   - Not sleepy enough: drop to `soothe` or `deep`, or lower beat from 6 Hz toward 4.5–5 Hz.

13. Suggested first builds (1-minute taste tests before committing)
   - Calm under narration:

```bash
uv run sleepstack --vibe calm -a campfire -m 1
```

   - Airy for deep voices:

```bash
uv run sleepstack --vibe airy -a campfire -m 1
```

   - Soothe for softer cadence:

```bash
uv run sleepstack --vibe soothe -a campfire -m 1
```

   - Quick 90-second test:

```bash
uv run sleepstack --vibe calm -a campfire -s 90
```

14. Workflow tip for versioning
   - Keep a short notes file next to your tracks listing date, vibe, beat/carrier, levels, and whether it "felt right" under your current script. It makes dialing in the next iteration trivial.

That's it — use `calm` as your default under narration, `airy` if your voice is deep, and `deep` only when you intentionally want to drift after the key lines.
